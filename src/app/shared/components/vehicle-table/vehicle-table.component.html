<section class="vehicle-table">
  <header class="vehicle-table__header">
    <div>
      <h3>Vehicles</h3>
      <p>Track VIN, status, and latest telemetry.</p>
    </div>
    <button
      mat-raised-button
      color="primary"
      (click)="addVehicle.emit()"
      *ngIf="showActions"
    >
      <mat-icon>add_road</mat-icon>
      Add vehicle
    </button>
  </header>

  <div class="mat-elevation-z1" *ngIf="vehicles.length; else emptyVehicles">
    <table mat-table [dataSource]="vehicles" class="full-width-table">
      <ng-container matColumnDef="vin">
        <th mat-header-cell *matHeaderCellDef>VIN</th>
        <td mat-cell *matCellDef="let vehicle">
          <strong>{{ vehicle.vin }}</strong>
          <div class="muted">{{ vehicle.modelYear || vehicle.year }} â€¢ {{ vehicle.model }}</div>
        </td>
      </ng-container>

      <ng-container matColumnDef="make">
        <th mat-header-cell *matHeaderCellDef>Make</th>
        <td mat-cell *matCellDef="let vehicle">
          {{ vehicle.make }}
        </td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let vehicle">
          <mat-form-field appearance="outline" *ngIf="showActions" class="status-select">
            <mat-select
              [value]="vehicle.status"
              (selectionChange)="onStatusChange(vehicle, $event.value)"
            >
              <mat-option *ngFor="let status of statuses" [value]="status">
                <span [class]="'status-badge status-' + status.toLowerCase()">{{ status }}</span>
              </mat-option>
            </mat-select>
          </mat-form-field>
          <span *ngIf="!showActions" [class]="'status-badge status-' + vehicle.status.toLowerCase()">
            {{ vehicle.status }}
          </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="telemetry">
        <th mat-header-cell *matHeaderCellDef>Telemetry</th>
        <td mat-cell *matCellDef="let vehicle">
          <div *ngIf="vehicle.lastTelemetry; else noTelemetry">
            <div>Speed: {{ vehicle.lastTelemetry?.speed }} km/h</div>
            <div>Fuel: {{ vehicle.lastTelemetry?.fuelLevel }}%</div>
          </div>
          <ng-template #noTelemetry>
            <span class="muted">No telemetry yet</span>
          </ng-template>
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let vehicle">
          <button
            mat-icon-button
            color="warn"
            (click)="deleteVehicle.emit(vehicle)"
            matTooltip="Remove vehicle"
            *ngIf="showActions"
          >
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="columns"></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: columns"
        [class.inactive]="row.status !== 'Available'"
      ></tr>
    </table>
  </div>

  <ng-template #emptyVehicles>
    <div class="empty-state">
      <p>No vehicles attached to this fleet.</p>
      <button
        mat-stroked-button
        color="primary"
        (click)="addVehicle.emit()"
        *ngIf="showActions"
      >
        Attach vehicle
      </button>
    </div>
  </ng-template>
</section>

